"use strict";(self.webpackChunkwelfie_docs=self.webpackChunkwelfie_docs||[]).push([[996],{6413:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var o=t(4848),s=t(8453);const i={},a="Authentication",r={id:"hero-ai/auth",title:"Authentication",description:"This page covers how the HeroAI website is using Welfie's user authentication service. This documentation is derived from the mobile authentication doc.",source:"@site/docs/hero-ai/auth.md",sourceDirName:"hero-ai",slug:"/hero-ai/auth",permalink:"/docs/hero-ai/auth",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/hero-ai/auth.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Introduction to Welfie HeroAI",permalink:"/docs/hero-ai/intro"},next:{title:"Installation",permalink:"/docs/hero-ai/installation"}},c={},l=[{value:"Signing In",id:"signing-in",level:2},{value:"Signing Out",id:"signing-out",level:2},{value:"Auth Context",id:"auth-context",level:2},{value:"Using it inside a React component",id:"using-it-inside-a-react-component",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"authentication",children:"Authentication"}),"\n",(0,o.jsxs)(n.p,{children:["This page covers how the HeroAI website is using Welfie's ",(0,o.jsx)(n.strong,{children:"user authentication"})," service. This documentation is derived from the ",(0,o.jsx)(n.a,{href:"/docs/mobile/auth",children:"mobile authentication doc"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"The app is using the following features,"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Log in functionality"}),"\n",(0,o.jsx)(n.li,{children:"Log out functionality"}),"\n",(0,o.jsx)(n.li,{children:"React context to pass authentication data"}),"\n"]}),"\n",(0,o.jsx)("hr",{}),"\n",(0,o.jsxs)(n.p,{children:["The HeroAI website is using ",(0,o.jsx)(n.a,{href:"https://axios-http.com/",children:"Axios"})," to handle HTTP requests. It is recommended to use something like ",(0,o.jsx)(n.a,{href:"https://postman.com/",children:"Postman"})," to test your api calls before running them directly from code."]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["The API routes covered in this documentation are derived from Welfie's ",(0,o.jsx)(n.a,{href:"https://bitbucket.org/welfietech/tenant-repo/src/master/welfie-web/src/controller/auth-controller.ts",children:"auth routes"})]})}),"\n",(0,o.jsx)(n.h2,{id:"signing-in",children:"Signing In"}),"\n",(0,o.jsx)(n.p,{children:"There are a few steps behind signing into Welfie's platform."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"You must generate a JWT token using a email and password."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="./context/auth-context.js"',children:'import axios from "axios";\n\n//... Other code\n\nconst generatedJWT = await axios.post("https://well-welfie-api-backend-aetaloqxpa-uw.a.run.app/auth/loginToken", {\n  email,\n  password,\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:"You will recieve the following payload,"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"{\n  loginToken: string;\n}\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"Do not publicly share or spread the token as it contains sensitive information about the user. In addition, JWT tokens should not be used on the client side without encryption."})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:"Once you have the token, you can use it to log into the platform. The body requires loginToken as the key."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="./context/auth-context.js"',children:'const response = await axios.post("https://well-welfie-api-backend-aetaloqxpa-uw.a.run.app/auth/login", {\n  loginToken: generatedJWT.data.loginToken,\n});\nconst user = response.data;\nconsole.log("Attempted authentication result:", user);\n'})}),"\n",(0,o.jsx)(n.p,{children:"Afterwards you will receieve the following payload afterwards,"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"{\n  hasProfile: boolean;\n  isEmailVerified: boolean;\n  isInvited: boolean;\n  lastActivity: Date;\n  token: string;\n}\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"We use an AppConfig for our API urls as the envrionment of the codebase can change."})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"Every API call involving data related to the user requires authentication using a bearer token. We use Axios' automatic header functionality to automatically set the bearer token with every API call."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="./context/auth-context.js"',children:'axios.defaults.headers.common["Authorization"] = `Bearer ${user.token}`;\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"4",children:["\n",(0,o.jsx)(n.li,{children:"Finally, to save the user's login activity on multiple app visits, we save the token in an encrypted storage so that the user does not need to sign in again when re-opening the app."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="./context/auth-context.js"',children:'//... previous code\n\n// Store the authenticated user data in encrypted local storage\nlocalStorage.setItem("user", JSON.stringify(user));\n'})}),"\n",(0,o.jsx)(n.p,{children:"Here is the full code for signing in,"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="./context/auth-context.js"',children:'const login = async (email, password) => {\n  if (loading) {\n    return { error: "Currently loading" };\n  }\n  setLoading(true);\n  try {\n    // Generate JWT token from backend\n    const generatedJWT = await axios.post("https://well-welfie-api-backend-aetaloqxpa-uw.a.run.app/auth/loginToken", {\n      email,\n      password,\n    });\n\n    console.log("Generated token:", generatedJWT.data.loginToken);\n\n    // Send login authentication request to backend. The body requires loginToken as the key\n    const response = await axios.post("https://well-welfie-api-backend-aetaloqxpa-uw.a.run.app/auth/login", {\n      loginToken: generatedJWT.data.loginToken,\n    });\n\n    const user = response.data;\n\n    console.log("Attempted authentication result:", user);\n\n    // Token retrieval indicates user is validated\n    setUser(user);\n    axios.defaults.headers.common["Authorization"] = `Bearer ${user.token}`;\n\n    console.log("Set http headers successfully");\n\n    // Store the authenticated user data in encrypted local storage\n    localStorage.setItem("user", JSON.stringify(user));\n    console.log("Saved token into storage");\n    setIsLogged(true);\n    setLoading(false);\n    return { success: "Successfully logged in" };\n  } catch (error) {\n    setLoading(false);\n    return { error: error.message || "Login failed" };\n  }\n};\n'})}),"\n",(0,o.jsx)(n.h2,{id:"signing-out",children:"Signing Out"}),"\n",(0,o.jsx)(n.p,{children:"We do the opposite functionality of signing in,"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="./context/auth-context.js"',children:'const logout = async () => {\n  if (loading) {\n    return { error: "Currently loading" };\n  }\n  setLoading(true);\n\n  try {\n    // Send a logout notice to the backend\n    axios.post("https://well-welfie-api-backend-aetaloqxpa-uw.a.run.app/auth/logout", {});\n\n    // Delete existing token from storage\n    localStorage.removeItem("user");\n\n    // Update HTTP headers\n    axios.defaults.headers.common["Authorization"] = "";\n\n    // Reset auth states\n    setUser(null);\n    setIsLogged(false);\n    setLoading(false);\n\n    console.log("User logged out.");\n\n    return { success: "Successfully logged out" };\n  } catch (error) {\n    setLoading(false);\n    return { error: error.message || "Logout failed" };\n  }\n};\n'})}),"\n",(0,o.jsx)(n.h2,{id:"auth-context",children:"Auth Context"}),"\n",(0,o.jsx)(n.p,{children:"The application is using React's context to provide the authenticated user to the rest of the application."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-jsx",metastring:'title="./App.js"',children:'import React from "react";\nimport AuthProvider from "./context/auth-context";\n\nexport default function RootLayout() {\n  return <AuthProvider>{/* children (Routes, Screens, ect.) */}</AuthProvider>;\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"We created a context provider that contains the authentication logic from the previous sections,"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-jsx",metastring:'title="./context/auth-context.js"',children:'import React, { createContext, useEffect, useState } from "react";\nimport axios from "axios";\n\nexport const AuthContext = createContext(undefined);\n\n// Create a context hook so that you can extract authenticated user in other components and hooks\n//highlight-next-line\nexport const AuthContext = (createContext < AuthProps) | (undefined > undefined);\n\nconst AuthProvider = ({ children }) => {\n  const [isLogged, setIsLogged] = useState(false);\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    // At the start of the application, immediately check if there is an existing user if they logged in before\n    const loadToken = async () => {\n      const userJSON = await SecureStore.getItemAsync("user");\n\n      if (userJSON) {\n        const user: AuthenticatedUser = JSON.parse(userJSON);\n        axios.defaults.headers.common["Authorization"] = `Bearer ${user.token}`;\n        setUser(user);\n        setIsLogged(true);\n      } else {\n        setUser(null);\n        setIsLogged(false);\n      }\n    };\n    loadToken();\n  }, []);\n\n  const login = async (email: string, password: string): Promise<{ error: any } | { success: string }> => {\n    // Login logic from previous section\n  };\n\n  const logout = async () => {\n    // Logout logic from previous section\n  };\n\n  const value: AuthProps = {\n    authenticated: isLogged,\n    currentUser: user,\n    loading,\n    login,\n    logout,\n  };\n\n  // Return the context provider along with the React children\n  //highlight-next-line\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n\nexport default AuthProvider;\n'})}),"\n",(0,o.jsx)(n.p,{children:"We create a hook to use the Auth Context."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-jsx",metastring:'title="./hooks/useAuth.js"',children:'import { AuthContext } from "../context/auth-context";\nimport { useContext } from "react";\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error("useAuth must be used within an AuthProvider");\n  }\n  return context;\n};\n'})}),"\n",(0,o.jsx)(n.h2,{id:"using-it-inside-a-react-component",children:"Using it inside a React component"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-jsx",children:'const Welcome = () => {\n  // Extract the authenticated status from auth context\n  //highlight-next-line\n  const { loading, authenticated } = useAuth();\n  if (!loading && authenticated) return <Redirect href="/" />;\n\n  return (\n    <div>\n      <h1>You are not logged in yet!</h1>\n    </div>\n  );\n};\n\nexport default Welcome;\n'})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var o=t(6540);const s={},i=o.createContext(s);function a(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);